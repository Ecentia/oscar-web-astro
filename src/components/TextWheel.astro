---
---
<section class="horizontal-section" id="gallery-strip">
    <div class="gallery-wrapper">
        <div class="gallery-track">
            
            <!-- ITEM 1: INTRO TEXT -->
            <div class="gallery-item text-item">
                <span class="stroke-text">THE</span>
                <span class="solid-text">VISION</span>
            </div>

            <!-- ITEM 2: PROFILE PHOTO -->
            <div class="gallery-item image-item">
                <div class="img-container">
                    <img src="/assets/foto_profile.jpg" alt="Oscar Profile" class="h-img" />
                </div>
                <span class="caption">01 — ARTIST</span>
            </div>

            <!-- ITEM 3: CONCEPT TEXT -->
            <div class="gallery-item text-item">
                <span class="solid-text">SONIC</span>
                <span class="stroke-text">DEPTH</span>
            </div>

            <!-- ITEM 4: CROWD PHOTO -->
            <div class="gallery-item image-item wide">
                <div class="img-container">
                    <img src="/assets/foto_crowd.jpg" alt="Crowd Energy" class="h-img" />
                </div>
                <span class="caption">02 — ENERGY</span>
            </div>

            <!-- ITEM 5: BIG TEXT -->
            <div class="gallery-item text-item">
                <span class="solid-text">NO</span>
                <span class="solid-text">LIMITS</span>
            </div>

            <!-- ITEM 6: DJ ACTION -->
            <div class="gallery-item image-item">
                <div class="img-container">
                    <img src="/assets/foto_dj.jpg" alt="Live Action" class="h-img" />
                </div>
                <span class="caption">03 — PERFORMANCE</span>
            </div>

             <!-- ITEM 7: PARIS/LOCATION -->
             <div class="gallery-item image-item">
                <div class="img-container">
                    <img src="/assets/foto_paris.jpg" alt="Paris" class="h-img" />
                </div>
                <span class="caption">04 — WORLDWIDE</span>
            </div>

            <!-- ITEM 8: OUTRO -->
            <div class="gallery-item text-item end">
                <span class="stroke-text">OSCAR</span>
                <span class="solid-text">HERRERA</span>
            </div>

        </div>
    </div>
</section>

<script>
    import { gsap } from "gsap";
    import { ScrollTrigger } from "gsap/ScrollTrigger";

    gsap.registerPlugin(ScrollTrigger);

    const section = document.getElementById('gallery-strip');
    const track = document.querySelector('.gallery-track') as HTMLElement;
    const images = document.querySelectorAll('.h-img');

    let scrollTween: gsap.core.Tween | null = null;

    function initScroll() {
        if(!track || !section) return;

        // Limpiar animaciones previas para evitar conflictos al redimensionar
        if (scrollTween) {
            scrollTween.kill();
            ScrollTrigger.getAll().forEach(t => {
                if(t.trigger === section) t.kill();
            });
        }

        // Forzar recalculo de layout para asegurar medidas correctas
        ScrollTrigger.refresh();

        const trackWidth = track.scrollWidth;
        const windowWidth = window.innerWidth;
        
        // El movimiento debe ser exactamente lo que sobra del ancho
        const xMovement = -(trackWidth - windowWidth);

        // Si el contenido es menor que la pantalla, no animamos
        if (trackWidth <= windowWidth) return;

        // Crear Timeline
        const tl = gsap.timeline({
            scrollTrigger: {
                trigger: section,
                start: "top top",
                // La duración es igual a la distancia a recorrer para un scroll 1:1 natural
                end: () => `+=${Math.abs(xMovement)}`, 
                pin: true,
                scrub: 1,
                invalidateOnRefresh: true,
                anticipatePin: 1,
            }
        });

        // 1. Movimiento Horizontal
        tl.to(track, {
            x: xMovement,
            ease: "none"
        });

        // 2. Parallax en imágenes
        images.forEach(img => {
            gsap.fromTo(img, 
                { objectPosition: "0% 50%" },
                {
                    objectPosition: "100% 50%",
                    ease: "none",
                    scrollTrigger: {
                        trigger: section,
                        start: "top top",
                        end: () => `+=${Math.abs(xMovement)}`,
                        scrub: 1
                    }
                }
            );
        });

        scrollTween = tl;
    }

    // Inicialización robusta
    window.addEventListener('load', () => {
        initScroll();
        ScrollTrigger.refresh(); // Refresco final por seguridad
    });
    
    // Reiniciar en resize para evitar roturas
    let resizeTimer;
    window.addEventListener('resize', () => {
        clearTimeout(resizeTimer);
        resizeTimer = setTimeout(() => {
            initScroll();
        }, 250);
    });

</script>

<style>
    .horizontal-section {
        background-color: #050505;
        color: #fff;
        height: 100vh;
        width: 100%;
        overflow: hidden;
        display: flex;
        align-items: center;
        position: relative;
        z-index: 10; /* Asegurar visibilidad sobre otros elementos */
    }

    .gallery-wrapper {
        width: 100%;
        height: 100%;
        display: flex;
        align-items: center;
        overflow: hidden; /* Importante para que no aparezca scrollbar nativa horizontal */
    }

    .gallery-track {
        display: flex;
        gap: 8vw;
        padding: 0 8vw;
        height: 60vh;
        align-items: center;
        width: max-content;
        will-change: transform; /* Optimización de rendimiento */
    }

    .gallery-item {
        display: flex;
        flex-direction: column;
        justify-content: center;
        flex-shrink: 0;
    }

    /* --- TEXT ITEMS --- */
    .text-item {
        justify-content: center;
        line-height: 0.85;
    }

    .solid-text {
        font-family: var(--font-display, sans-serif);
        font-size: 15vh;
        color: #fff;
        text-transform: uppercase;
        letter-spacing: -0.04em;
        white-space: nowrap;
    }

    .stroke-text {
        font-family: var(--font-display, sans-serif);
        font-size: 15vh;
        color: transparent;
        -webkit-text-stroke: 2px #fff;
        text-transform: uppercase;
        letter-spacing: -0.04em;
        white-space: nowrap;
        opacity: 0.5;
    }

    /* --- IMAGE ITEMS --- */
    .image-item {
        height: 100%;
        position: relative;
        gap: 20px;
    }

    .img-container {
        height: 100%;
        width: 45vh;
        overflow: hidden;
        border-radius: 4px;
        background: #111;
        box-shadow: 0 10px 30px rgba(0,0,0,0.5); /* Sombra para profundidad */
    }

    .image-item.wide .img-container {
        width: 70vh;
    }

    .h-img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        /* Quitamos grayscale, mantenemos un poco de contraste para look premium */
        filter: contrast(1.1) saturate(1.1); 
        transition: transform 0.5s ease;
    }

    /* Hover effect: Ligero zoom en lugar de cambio de color */
    .image-item:hover .h-img {
        transform: scale(1.05);
    }

    .caption {
        font-family: var(--font-mono, monospace);
        font-size: 0.8rem;
        letter-spacing: 0.1em;
        color: #888;
        border-top: 1px solid #333;
        padding-top: 10px;
        display: block;
    }

    @media (max-width: 768px) {
        .gallery-track {
            height: 50vh;
            gap: 40px;
            padding: 0 40px;
        }
        
        .solid-text, .stroke-text { font-size: 10vh; }
        .img-container { width: 35vh; }
        .image-item.wide .img-container { width: 50vh; }
    }
</style>