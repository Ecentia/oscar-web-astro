---
// src/components/TextWheel.astro

const phrases = [
  "OSCAR HERRERA",
  "GLOBAL FREQUENCY",
  "IBIZA RESIDENCY",
  "WORLD TOUR 2025",
  "MADRID • SPAIN",
  "TECHNO CULTURE",
  "MAIN STAGE",
  "SOLD OUT",
  "UNDERGROUND",
  "LIVE PERFORMANCE"
];

// Duplicamos más veces para cerrar el círculo perfectamente sin huecos
const items = [...phrases, ...phrases, ...phrases]; 
---

<section class="wheel-container" data-bgcolor="#000000" data-textcolor="#FFFFFF">
  <div class="wheel-viewport">
    <div class="wheel">
      {items.map((text, index) => (
        <div class="wheel-item">
          <h2 class="text-content">{text}</h2>
        </div>
      ))}
    </div>
  </div>
  <div class="fade-overlay top"></div>
  <div class="fade-overlay bottom"></div>
</section>

<script>
  import { gsap } from "gsap";
  import { ScrollTrigger } from "gsap/ScrollTrigger";

  gsap.registerPlugin(ScrollTrigger);

  const wheel = document.querySelector(".wheel") as HTMLElement;
  const items = document.querySelectorAll(".wheel-item");
  const numItems = items.length;
  const angleStep = 360 / numItems;
  
  // RADIO MÁS AMPLIO = Más separación entre líneas
  const radius = "60vw"; 

  // Configuración inicial
  items.forEach((item, index) => {
    const el = item as HTMLElement;
    gsap.set(el, {
      rotationX: -index * angleStep,
      z: radius,
      transformOrigin: `50% 50% -${radius}`
    });
  });

  // Animación suave
  gsap.to(wheel, {
    rotationX: 360,
    ease: "none",
    scrollTrigger: {
      trigger: ".wheel-container",
      start: "top bottom",
      end: "bottom top",
      scrub: 1,
    }
  });
</script>

<style>
  .wheel-container {
    height: 120vh;
    width: 100%;
    position: relative;
    overflow: hidden;
    background-color: transparent;
    display: flex;
    align-items: center;
    justify-content: center;
    /* TRUCO PRO: Máscara que desvanece arriba y abajo para que no se vea el texto aplastado */
    mask-image: linear-gradient(to bottom, 
      transparent 0%, 
      black 25%, 
      black 75%, 
      transparent 100%
    );
    -webkit-mask-image: linear-gradient(to bottom, 
      transparent 0%, 
      black 25%, 
      black 75%, 
      transparent 100%
    );
  }

  .wheel-viewport {
    width: 100%;
    height: 100%;
    perspective: 2000px; /* Perspectiva más plana para mayor legibilidad */
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .wheel {
    position: relative;
    transform-style: preserve-3d;
    width: 100%;
    height: 100px; /* Altura base pequeña para centrar */
  }

  .wheel-item {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 100%;
    text-align: center;
    /* CRUCIAL: Oculta la parte trasera de la rueda para que no ensucie */
    backface-visibility: hidden; 
    -webkit-backface-visibility: hidden;
  }

  .text-content {
    font-family: 'Anton', sans-serif;
    /* Tamaño fijo en vw para que escale perfecto */
    font-size: 6vw; 
    margin: 0;
    color: #fff;
    text-transform: uppercase;
    letter-spacing: 2px;
    white-space: nowrap;
    
    /* Pequeño contorno negro para separar si algo se cruza */
    text-shadow: 0 0 10px rgba(0,0,0,0.8);
  }
</style>